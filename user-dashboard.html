<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</title>

<style>
/* ===== THEME ===== */
:root{
  --bg:#ffffff;
  --card:#f8fafc;
  --line:#e5e7eb;
  --text:#0f172a;
  --muted:#64748b;
  --free:#16a34a;
  --busy:#dc2626;
  --soon:#ca8a04;
}
[data-theme="dark"]{
  --bg:#020617;
  --card:#0f172a;
  --line:#1e293b;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --free:#22c55e;
  --busy:#ef4444;
  --soon:#facc15;
}
/* ================= */

body{
  margin:0;
  padding:24px;
  font-family:system-ui,Segoe UI,Arial;
  background:var(--bg);
  color:var(--text);
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
  gap:16px;
  flex-wrap:wrap;
}
.brand{
  display:flex;
  align-items:center;
  gap:16px;
}
.brand img{
  width:64px;height:64px;
  border-radius:12px;
  object-fit:contain;
}
.brand h1{
  margin:0;
  font-size:34px;
  font-weight:900;
}
.brand .sub{
  font-size:16px;
  color:var(--muted);
}

.controls{
  display:flex;
  gap:10px;
}
button{
  padding:10px 14px;
  border-radius:12px;
  border:1px solid var(--line);
  background:var(--card);
  font-weight:700;
  cursor:pointer;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:20px;
}

.room{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:24px;
  padding:24px;
  display:flex;
  flex-direction:column;
  gap:12px;
  box-shadow:0 15px 35px rgba(0,0,0,.15);
}
.room h2{
  margin:0;
  font-size:30px;
  font-weight:900;
}
.status{
  font-size:26px;
  font-weight:900;
}
.free{color:var(--free);}
.busy{color:var(--busy);}
.soon{color:var(--soon);}

.detail{
  font-size:18px;
  color:var(--muted);
  line-height:1.5;
}

.next{
  margin-top:8px;
  padding-top:8px;
  border-top:1px dashed var(--line);
  font-size:16px;
  color:var(--muted);
}

footer{
  margin-top:20px;
  font-size:14px;
  color:var(--muted);
  text-align:right;
}
</style>
</head>

<body data-theme="light">

<header>
  <div class="brand">
    <!-- üî¥ ‡πÅ‡∏Å‡πâ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
    <img src="https://namyennn.github.io/room-booking/LOGOCS.png" alt="School Logo">
    <div>
      <!-- üî¥ ‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
      <h1>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÄ‡∏¢‡πá‡∏ô</h1>
      <div class="sub">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</div>
    </div>
  </div>

  <div class="controls">
    <button id="btnTheme">üåô Dark</button>
    <button id="btnFS">‚õ∂ Fullscreen</button>
  </div>
</header>

<div id="grid" class="grid"></div>

<footer id="updated">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Ä¶</footer>

<script>
/* ===== CONFIG ===== */
const API = 'https://script.google.com/macros/s/AKfycbyKKtN_gWMWEW30eCjgfWSfF9m1AWPtYweRoPV7VPkPx21HoyhQO5oGGkbi08VsmcxCIQ/exec';
const REFRESH_SEC = 15;
const SOON_MIN = 15;
/* ================= */

function minutes(t){
  const [h,m]=t.split(':').map(Number);
  return h*60+m;
}
function nowMin(){
  const d=new Date();
  return d.getHours()*60+d.getMinutes();
}

async function load(){
  const today=new Date().toISOString().slice(0,10);
  const r=await fetch(`${API}?action=calendar&date_from=${today}&date_to=${today}&v=${Date.now()}`);
  const d=await r.json();
  render(d.items||[]);
  document.getElementById('updated').textContent =
    '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î '+new Date().toLocaleTimeString();
}

function render(items){
  const grid=document.getElementById('grid');
  grid.innerHTML='';

  const byRoom={};
  items.forEach(it=>{
    if(!byRoom[it.room_id]) byRoom[it.room_id]=[];
    byRoom[it.room_id].push(it);
  });

  const now=nowMin();

  Object.keys(byRoom).forEach(room=>{
    const list=byRoom[room].sort((a,b)=>minutes(a.start)-minutes(b.start));
    let cls='free', status='‡∏ß‡πà‡∏≤‡∏á', detail='‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á', next='';

    for(let i=0;i<list.length;i++){
      const b=list[i];
      const s=minutes(b.start), e=minutes(b.end);

      if(now>=s && now<e){
        cls='busy';
        const left=e-now;
        status=`üî¥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (${left} ‡∏ô‡∏≤‡∏ó‡∏µ)`;
        detail=`${b.start} ‚Äì ${b.end}<br>${b.by||''}`;
        if(list[i+1]){
          const n=list[i+1];
          next=`‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ${n.start} ‚Äì ${n.end} (${n.by||''})`;
        }
        break;
      }
      if(now<s && s-now<=SOON_MIN){
        cls='soon';
        status=`üü° ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ô ${s-now} ‡∏ô‡∏≤‡∏ó‡∏µ`;
        detail=`${b.start} ‚Äì ${b.end}<br>${b.by||''}`;
        next=list[i+1] ? `‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ${list[i+1].start} ‚Äì ${list[i+1].end}` : '';
        break;
      }
    }

    const el=document.createElement('div');
    el.className='room';
    el.innerHTML=`
      <h2>${room}</h2>
      <div class="status ${cls}">${status}</div>
      <div class="detail">${detail}</div>
      ${next?`<div class="next">üìå ${next}</div>`:''}
    `;
    grid.appendChild(el);
  });
}

/* ===== THEME ===== */
const btnTheme=document.getElementById('btnTheme');
btnTheme.onclick=()=>{
  const b=document.body;
  const dark=b.getAttribute('data-theme')==='dark';
  b.setAttribute('data-theme',dark?'light':'dark');
  btnTheme.textContent=dark?'üåô Dark':'‚òÄÔ∏è Light';
};

/* ===== FULLSCREEN ===== */
document.getElementById('btnFS').onclick=()=>{
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen();
  }else{
    document.exitFullscreen();
  }
};

/* ===== START ===== */
load();
setInterval(load,REFRESH_SEC*1000);
</script>

</body>
</html>
