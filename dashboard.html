<!doctype html><html lang="th"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dashboard ห้องประชุม</title>
<style>body{font-family:system-ui,Segoe UI,Arial;padding:16px;max-width:1000px;margin:auto}.grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}select,input,button{padding:10px;border:1px solid #ccc;border-radius:8px;width:100%}table{width:100%;border-collapse:collapse;margin-top:12px}th,td{border:1px solid #eee;padding:8px;text-align:left}th{background:#fafafa}.pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid #ccc;margin-right:6px}.free{border-color:#2e7d32;color:#2e7d32}.busy{border-color:#b00020;color:#b00020}.muted{color:#666;font-size:12px}</style>
</head><body>
<h1>Dashboard ห้องประชุม</h1>
<div class="grid">
  <div><label>ห้อง</label><select id="room"></select></div>
  <div><label>วันที่เริ่ม</label><input type="date" id="from"></div>
  <div><label>วันที่สิ้นสุด</label><input type="date" id="to"></div>
</div>
<div style="margin-top:12px"><button id="load">โหลดข้อมูล</button> <span class="muted">* แสดงเฉพาะรายการที่ยังไม่ถูกยกเลิก</span></div>
<div id="summary" style="margin-top:16px"></div>
<table id="tbl" style="display:none"><thead><tr><th>วันที่</th><th>ห้อง</th><th>เวลา</th><th>ผู้จอง</th><th>วัตถุประสงค์</th><th>Ref</th></tr></thead><tbody></tbody></table>
<script>
// TODO: วางค่าของคุณ
const API = 'https://script.google.com/macros/s/AKfycbzX3qDwakFm0-Fls1O4_fDuiZMauPzGeuuhB-7HRPcw/exec';

async function api(path){ const r=await fetch(API+path); return r.json(); }
async function loadRooms(){ const r=await api('?action=rooms'); const sel=room; sel.innerHTML=''; const optAll=document.createElement('option'); optAll.value=''; optAll.textContent='ทุกห้อง'; sel.appendChild(optAll); (r.rooms||[]).forEach(x=>{ const o=document.createElement('option'); o.value=x.room_id; o.textContent=x.room_name||x.room_id; sel.appendChild(o); }); }
function groupBy(a,k){ return a.reduce((m,x)=>((m[x[k]]=m[x[k]]||[]).push(x),m),{}); }
async function load(){
  const rmid=room.value, from=frm.value, to=toEl.value;
  const r=await api(`?action=calendar&room_id=${encodeURIComponent(rmid)}&date_from=${encodeURIComponent(from)}&date_to=${encodeURIComponent(to)}`);
  const tb=tbl.querySelector('tbody'); tb.innerHTML='';
  const g=groupBy(r.items||[],'date'); const days=Object.keys(g).sort(); summary.innerHTML=days.length?days.map(d=>`<span class="pill busy">${d}: ${g[d].length} รายการ</span>`).join(' '):'<span class="pill free">ยังไม่มีการจองในช่วงนี้</span>';
  (r.items||[]).sort((a,b)=>(a.date+a.start).localeCompare(b.date+b.start)).forEach(x=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${x.date}</td><td>${x.room_id}</td><td>${x.start}–${x.end}</td><td>${x.by||'-'}</td><td>${x.purpose||''}</td><td>${x.ref}</td>`; tb.appendChild(tr); });
  tbl.style.display=(r.items||[]).length?'':'none';
}
const room=document.getElementById('room'), frm=document.getElementById('from'), toEl=document.getElementById('to'), summary=document.getElementById('summary'), tbl=document.getElementById('tbl');
document.getElementById('load').onclick=load;
(async ()=>{ await loadRooms(); const today=new Date().toISOString().slice(0,10); frm.value=today; toEl.value=today; await load(); })();
</script>
</body></html>
